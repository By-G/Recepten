<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Mijn Recepten">
<title>Mijn Recepten</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --blue: #0063d3; --blue-dark: #004fa3; --blue-light: #e8f1fb;
    --yellow: #f5d000; --green: #2e7d32;
    --g50: #f7f8fa; --g100: #eef0f3; --g200: #dde1e7;
    --g500: #7a8494; --g700: #3d4452; --g900: #1a1f2e;
    --red: #d32f2f; --r: 12px;
    --sh: 0 1px 4px rgba(0,0,0,0.08); --shm: 0 4px 16px rgba(0,0,0,0.10);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
  body { font-family: 'Nunito', sans-serif; background: var(--g50); color: var(--g900); min-height: 100vh; max-width: 480px; margin: 0 auto; }

  /* HEADER */
  .hdr { background: var(--blue); padding: 14px 16px 12px; display: flex; align-items: center; gap: 10px; position: sticky; top: 0; z-index: 200; }
  .logo { font-weight: 800; font-size: 0.85rem; background: var(--yellow); color: var(--blue-dark); padding: 4px 10px; border-radius: 6px; flex-shrink: 0; }
  .hdr-title { font-weight: 700; font-size: 1rem; color: white; flex: 1; }
  .back { background: none; border: none; color: white; font-size: 1.6rem; cursor: pointer; padding: 0 6px 0 0; line-height: 1; }
  .icon-btn { background: rgba(255,255,255,0.18); border: none; border-radius: 8px; color: white; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.3rem; flex-shrink: 0; }
  .icon-btn:hover { background: rgba(255,255,255,0.28); }

  /* VIEWS */
  .view { display: none; }
  .view.on { display: block; }

  /* SEARCH */
  .search-section { background: var(--blue); padding: 0 16px 14px; }
  .search-box { background: white; border-radius: 10px; display: flex; align-items: center; padding: 0 12px; gap: 8px; }
  .search-box span { color: var(--g500); }
  .search-box input { flex: 1; border: none; outline: none; font-family: 'Nunito', sans-serif; font-size: 0.95rem; padding: 11px 0; color: var(--g900); background: transparent; }

  /* TOOLS */
  .tools-row { display: flex; gap: 8px; padding: 12px 16px 0; flex-wrap: wrap; }
  .chip { display: flex; align-items: center; gap: 5px; padding: 7px 12px; border-radius: 20px; border: 1.5px solid var(--g200); background: white; font-family: 'Nunito', sans-serif; font-size: 0.8rem; font-weight: 600; color: var(--g700); cursor: pointer; }
  .chip:hover { border-color: var(--blue); color: var(--blue); }

  /* LIST */
  .section-head { padding: 14px 16px 8px; font-size: 0.75rem; font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase; color: var(--g500); }
  .recipe-grid { padding: 0 16px 24px; display: flex; flex-direction: column; gap: 10px; }
  .recipe-card { background: white; border-radius: var(--r); overflow: hidden; box-shadow: var(--sh); cursor: pointer; border: 1.5px solid var(--g100); display: flex; align-items: stretch; transition: all 0.15s; }
  .recipe-card:hover { box-shadow: var(--shm); border-color: var(--blue); transform: translateY(-1px); }
  .card-img { width: 90px; background: var(--g100); display: flex; align-items: center; justify-content: center; font-size: 2.4rem; flex-shrink: 0; }
  .card-body { flex: 1; padding: 12px 12px 12px 14px; display: flex; flex-direction: column; justify-content: center; gap: 5px; }
  .card-name { font-size: 0.95rem; font-weight: 700; color: var(--g900); line-height: 1.25; }
  .card-tags { display: flex; gap: 5px; flex-wrap: wrap; }
  .tag { font-size: 0.72rem; font-weight: 700; padding: 2px 7px; border-radius: 20px; background: var(--blue-light); color: var(--blue); }
  .tag.green { background: #e8f5e9; color: var(--green); }
  .card-meta-row { display: flex; gap: 10px; }
  .card-meta-item { font-size: 0.77rem; color: var(--g500); font-weight: 600; }
  .card-arrow { padding: 0 12px 0 4px; color: var(--blue); font-size: 1.2rem; display: flex; align-items: center; }
  .empty-state { text-align: center; padding: 60px 20px; }
  .empty-state .emoji { font-size: 3rem; margin-bottom: 12px; }
  .empty-state p { color: var(--g500); font-size: 0.95rem; line-height: 1.6; }

  /* DETAIL */
  .detail-hero { background: var(--blue-light); height: 180px; display: flex; align-items: center; justify-content: center; font-size: 5rem; }
  .detail-body { padding: 0 16px 40px; }
  .detail-title { font-size: 1.4rem; font-weight: 800; margin-top: 16px; line-height: 1.2; }
  .source-line { font-size: 0.85rem; color: var(--g500); margin-top: 4px; font-weight: 600; }
  .source-line a { color: var(--blue); text-decoration: none; font-weight: 700; }
  .stats-row { display: flex; border: 1.5px solid var(--g200); border-radius: var(--r); margin-top: 16px; overflow: hidden; background: white; }
  .stat { flex: 1; padding: 12px 8px; text-align: center; border-right: 1.5px solid var(--g200); }
  .stat:last-child { border-right: none; }
  .stat-icon { font-size: 1.1rem; }
  .stat-val { font-size: 0.9rem; font-weight: 800; margin-top: 2px; }
  .stat-lbl { font-size: 0.7rem; color: var(--g500); font-weight: 600; }
  .sec-title { font-size: 1rem; font-weight: 800; margin: 22px 0 10px; }
  .persons-row { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
  .persons-lbl { font-size: 0.85rem; color: var(--g500); font-weight: 700; }
  .persons-ctrl { display: flex; align-items: center; border: 1.5px solid var(--g200); border-radius: 8px; overflow: hidden; background: white; }
  .p-btn { width: 34px; height: 34px; border: none; background: none; font-size: 1.2rem; cursor: pointer; color: var(--blue); font-weight: 800; display: flex; align-items: center; justify-content: center; }
  .p-btn:hover { background: var(--blue-light); }
  .p-val { width: 32px; text-align: center; font-weight: 800; font-size: 0.95rem; border-left: 1.5px solid var(--g200); border-right: 1.5px solid var(--g200); padding: 4px 0; }
  .ingr-list { list-style: none; border: 1.5px solid var(--g200); border-radius: var(--r); overflow: hidden; background: white; }
  .ingr-item { display: flex; align-items: center; gap: 12px; padding: 11px 14px; border-bottom: 1px solid var(--g100); font-size: 0.9rem; }
  .ingr-item:last-child { border-bottom: none; }
  .ingr-amt { font-weight: 700; color: var(--blue); min-width: 70px; font-size: 0.88rem; }
  .ingr-name { flex: 1; color: var(--g700); font-weight: 600; }
  .step-list { list-style: none; display: flex; flex-direction: column; gap: 10px; }
  .step-item { background: white; border: 1.5px solid var(--g200); border-radius: var(--r); padding: 14px; display: flex; gap: 12px; font-size: 0.9rem; line-height: 1.55; color: var(--g700); font-weight: 600; }
  .step-num { width: 28px; height: 28px; border-radius: 8px; background: var(--blue); color: white; font-size: 0.85rem; font-weight: 800; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .tip-box { background: #fff8e1; border-left: 4px solid var(--yellow); border-radius: 0 var(--r) var(--r) 0; padding: 12px 14px; font-size: 0.87rem; color: #5d4037; font-weight: 600; margin-top: 10px; }
  .del-btn { margin-top: 24px; width: 100%; padding: 13px; background: none; border: 1.5px solid #ffcdd2; border-radius: var(--r); color: var(--red); font-family: 'Nunito', sans-serif; font-size: 0.9rem; font-weight: 700; cursor: pointer; }
  .del-btn:hover { background: #ffebee; }

  /* FORM */
  .form-body { padding: 16px 16px 60px; }
  .fsec { font-size: 0.75rem; font-weight: 800; letter-spacing: 0.1em; text-transform: uppercase; color: var(--blue); margin: 20px 0 8px; }
  .fsec:first-child { margin-top: 0; }
  .ff { margin-bottom: 12px; }
  .ff label { display: block; font-size: 0.82rem; font-weight: 700; color: var(--g700); margin-bottom: 5px; }
  .ff input, .ff textarea { width: 100%; padding: 11px 13px; border: 1.5px solid var(--g200); border-radius: 10px; font-family: 'Nunito', sans-serif; font-size: 0.93rem; font-weight: 600; color: var(--g900); background: white; outline: none; transition: border-color 0.15s; }
  .ff input:focus, .ff textarea:focus { border-color: var(--blue); }
  .ff textarea { min-height: 110px; resize: vertical; line-height: 1.5; }
  .hint { font-size: 0.77rem; color: var(--g500); margin-top: 4px; font-weight: 600; }
  .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .save-btn { width: 100%; padding: 15px; background: var(--blue); color: white; border: none; border-radius: var(--r); font-family: 'Nunito', sans-serif; font-size: 1rem; font-weight: 800; cursor: pointer; margin-top: 16px; }
  .save-btn:hover { background: var(--blue-dark); }

  /* PASTE */
  .paste-body { padding: 16px 16px 60px; }
  .paste-info { background: var(--blue-light); border-radius: var(--r); padding: 12px 14px; font-size: 0.85rem; color: var(--blue); font-weight: 600; margin-bottom: 16px; line-height: 1.5; }
  .parse-btn { width: 100%; padding: 13px; background: var(--blue); color: white; border: none; border-radius: var(--r); font-family: 'Nunito', sans-serif; font-size: 0.95rem; font-weight: 800; cursor: pointer; margin-top: 8px; }
  .parse-btn:hover { background: var(--blue-dark); }
  .parse-result { margin-top: 16px; background: white; border: 1.5px solid var(--g200); border-radius: var(--r); padding: 14px; font-size: 0.88rem; color: var(--g700); font-weight: 600; line-height: 1.7; }
  .parse-result strong { color: var(--blue); }
  .confirm-btn { width: 100%; padding: 13px; background: var(--green); color: white; border: none; border-radius: var(--r); font-family: 'Nunito', sans-serif; font-size: 0.95rem; font-weight: 800; cursor: pointer; margin-top: 10px; }
  .confirm-btn:hover { background: #1b5e20; }
  .hidden { display: none; }
</style>
</head>
<body>

<!-- ‚ïê‚ïê LIST ‚ïê‚ïê -->
<div id="v-list" class="view">
  <header class="hdr">
    <div class="logo">Gianni</div>
    <span class="hdr-title">Mijn Recepten</span>
    <button class="icon-btn" onclick="gotoForm()">+</button>
  </header>
  <div class="search-section">
    <div class="search-box">
      <span>üîç</span>
      <input type="search" id="search-input" placeholder="Zoek een recept..." oninput="renderList()">
    </div>
  </div>
  <div class="tools-row">
    <button class="chip" onclick="exportRecipes()">üì§ Backup</button>
    <button class="chip" onclick="document.getElementById('import-file').click()">üì• Importeer</button>
    <button class="chip" onclick="gotoPaste()">üìã Plak recept</button>
    <input type="file" id="import-file" accept=".json" style="display:none" onchange="importRecipes(event)">
  </div>
  <div class="section-head" id="count-label"></div>
  <div class="recipe-grid" id="recipe-grid"></div>
</div>

<!-- ‚ïê‚ïê DETAIL ‚ïê‚ïê -->
<div id="v-detail" class="view">
  <header class="hdr">
    <button class="back" onclick="gotoList()">‚Äπ</button>
    <span class="hdr-title" id="detail-header"></span>
  </header>
  <div id="detail-content"></div>
</div>

<!-- ‚ïê‚ïê FORM ‚ïê‚ïê -->
<div id="v-form" class="view">
  <header class="hdr">
    <button class="back" onclick="gotoList()">‚Äπ</button>
    <span class="hdr-title">Nieuw recept</span>
  </header>
  <div class="form-body">
    <div class="fsec">Basisinfo</div>
    <div class="ff"><label>Naam *</label><input type="text" id="f-name" placeholder="bv. Fusilli met tomatensaus"></div>
    <div class="two-col">
      <div class="ff"><label>Emoji</label><input type="text" id="f-emoji" placeholder="üçù" maxlength="2"></div>
      <div class="ff"><label>Personen</label><input type="number" id="f-persons" placeholder="4" min="1"></div>
    </div>
    <div class="two-col">
      <div class="ff"><label>Bereidingstijd</label><input type="text" id="f-time" placeholder="30 min"></div>
      <div class="ff"><label>Kcal p.p.</label><input type="number" id="f-kcal" placeholder="530"></div>
    </div>
    <div class="fsec">Ingredi√´nten</div>
    <div class="ff">
      <textarea id="f-ingredients" placeholder="E√©n ingredi√´nt per regel:&#10;300 g fusilli&#10;1 el olijfolie"></textarea>
      <p class="hint">Hoeveelheid + product op dezelfde regel</p>
    </div>
    <div class="fsec">Bereidingswijze</div>
    <div class="ff">
      <textarea id="f-steps" placeholder="E√©n stap per regel:&#10;Kook de pasta beetgaar.&#10;Verhit olijfolie."></textarea>
      <p class="hint">Elke stap op een nieuwe regel. Nummering hoeft niet.</p>
    </div>
    <div class="fsec">Extra (optioneel)</div>
    <div class="ff"><label>Tip</label><input type="text" id="f-tip" placeholder="bv. Lekker met basilicumblaadjes"></div>
    <div class="ff"><label>Bron / URL</label><input type="url" id="f-source" placeholder="https://..."></div>
    <button class="save-btn" onclick="saveRecipe()">‚úì Recept opslaan</button>
  </div>
</div>

<!-- ‚ïê‚ïê PASTE ‚ïê‚ïê -->
<div id="v-paste" class="view">
  <header class="hdr">
    <button class="back" onclick="gotoList()">‚Äπ</button>
    <span class="hdr-title">Recept plakken</span>
  </header>
  <div class="paste-body">
    <div class="paste-info">
      üìã Kopieer een recept uit je Notities of van een website en plak het hieronder. De app herkent automatisch de naam, ingredi√´nten en bereidingsstappen.
    </div>
    <div class="ff">
      <label>Plak hier je recept</label>
      <textarea id="paste-input" style="min-height:220px" placeholder="# Naam van het recept&#10;&#10;Voor 4 personen&#10;&#10;Ingredi√´nten&#10;- 300 g pasta&#10;- 1 ui&#10;&#10;Bereidingswijze&#10;1. Kook de pasta...&#10;2. Bak de ui..."></textarea>
    </div>
    <button class="parse-btn" onclick="parseRecipe()">üîç Verwerk recept</button>
    <div id="parse-result" class="parse-result hidden"></div>
    <button id="confirm-btn" class="confirm-btn hidden" onclick="confirmPaste()">‚úì Recept toevoegen aan lijst</button>
  </div>
</div>

<script>
const KEY = 'mijn_recepten_v2';

// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ
const DEFAULTS = [
  {
    id:1, name:"Vega-bonensoep", emoji:"üç≤", persons:4, time:"30 min", kcal:null,
    ingredients:[{amount:"50 g",name:"boter"},{amount:"2",name:"winterpenen"},{amount:"1",name:"prei"},{amount:"1",name:"ui"},{amount:"3",name:"aardappelen"},{amount:"2",name:"bouillontabletten (groente)"},{amount:"1 blik",name:"bruine bonen (400 g)"},{amount:"1 liter",name:"water"},{amount:"naar smaak",name:"peper en zout"},{amount:"optioneel",name:"vegetarische spekjes en gebakken uitjes"}],
    steps:["Snijd de winterpeen in kleine blokjes, de prei in dunne ringen en de aardappelen in blokjes.","Verhit 25 g boter in een soeppan en bak de helft van de peen, prei, ui en aardappel 5 minuten.","Voeg de bouillontabletten, bruine bonen en 1 liter water toe. Breng aan de kook en laat 8 minuten zachtjes koken.","Haal de pan van het vuur en pureer de soep met een staafmixer. Breng op smaak met peper en zout.","Voeg de rest van de groenten toe en kook nog 6-7 minuten tot de groenten beetgaar zijn. Roer regelmatig.","Verhit de rest van de boter en bak de vegetarische spekjes 3 minuten bruin. Voeg toe aan de soep.","Serveer met gebakken uitjes."],
    tip:null, source:"https://www.ah.nl/allerhande/recept/R-R853380/vega-bonensoep"
  },
  {
    id:2, name:"Fusilli met groentesaus en hamblokjes", emoji:"üçù", persons:4, time:"15 min", kcal:530,
    ingredients:[{amount:"300 g",name:"fusilli"},{amount:"1 el",name:"traditionele olijfolie"},{amount:"450 g",name:"macaroni-spaghettigroente"},{amount:"250 g",name:"hamblokjes"},{amount:"520 g",name:"AH BASIC pastasaus basilicum"},{amount:"50 g",name:"Grana Padano 32+"}],
    steps:["Kook de fusilli beetgaar volgens de aanwijzingen op de verpakking. Verhit ondertussen de olijfolie in een hapjespan en bak de groenten 5 min. op middelhoog vuur.","Voeg de hamblokjes toe en bak 1 min. mee. Schenk de pastasaus bij het groente-hammengsel en warm 2 min. goed door.","Giet de pasta af en meng door de saus. Rasp er de Grana Padano over en serveer."],
    tip:"Lekker met basilicumblaadjes.", source:"https://www.ah.nl/allerhande/recept/R-R1190891/fusilli-met-groentesaus-en-hamblokjes"
  },
  {
    id:3, name:"Frittata met spinazie", emoji:"üç≥", persons:4, time:"30 min", kcal:null,
    ingredients:[{amount:"300 g",name:"verse spinazie"},{amount:"2",name:"tomaten"},{amount:"1",name:"ui"},{amount:"1 el",name:"Italiaanse kruiden"},{amount:"3",name:"eieren"},{amount:"scheutje",name:"melk"},{amount:"naar smaak",name:"geraspte kaas"},{amount:"naar smaak",name:"zout en peper"}],
    steps:["Verwarm de oven voor op 200 ¬∞C.","Snijd de ui en tomaten in stukjes.","Giet een scheutje olie in een pan en fruit de ui aan. Voeg na 2-3 minuten de spinazie toe en bak totdat de spinazie geslonken is.","Voeg de blokjes tomaat en Italiaanse kruiden toe en bak een paar minuten mee.","Laat de spinazie eventueel uitlekken in een zeef als het geheel erg vochtig is.","Meng in een kom de eieren met de melk.","Schep de spinazie in een ovenschaal. Giet het eimengsel eroverheen. Strooi wat geraspte kaas erover.","Zet de frittata circa 20 minuten in de voorverwarmde oven."],
    tip:null, source:"https://www.lekkerensimpel.com/frittata-met-spinazie/"
  },
  {
    id:4, name:"Ovenschotel met sperziebonen", emoji:"ü•ò", persons:3, time:"40 min", kcal:null,
    ingredients:[{amount:"500 g",name:"aardappelschijfjes (voorgekookt)"},{amount:"400 g",name:"sperziebonen"},{amount:"200 g",name:"vegetarisch gehakt"},{amount:"2 tenen",name:"knoflook"},{amount:"1",name:"ui"},{amount:"1",name:"rode peper"},{amount:"2 el",name:"cr√®me fra√Æche"},{amount:"2 el",name:"ketjap manis"},{amount:"150 g",name:"geraspte kaas"},{amount:"naar smaak",name:"margarine, olie en peper"}],
    steps:["Verwarm de oven voor op 200 ¬∞C. Vet een ovenschaal in met margarine.","Kook de sperziebonen 5 minuten.","Snipper de ui, snijd de rode peper en knoflook fijn.","Verhit een scheutje olie en fruit de ui. Voeg het gehakt toe en bak kort mee.","Voeg de rode peper en knoflook toe en bak 3-4 minuten mee.","Voeg de ketjap, cr√®me fra√Æche en sperziebonen toe, roer goed en bak 2 minuten op laag vuur.","Schep in de ovenschaal, dek af met de aardappelschijfjes en strooi kaas erover.","Bak 20 minuten in de oven tot de kaas gesmolten is."],
    tip:null, source:"https://www.puursuzanne.nl/recepten/ovenschotel-met-sperziebonen"
  },
  {
    id:5, name:"Turkse linzensoep", emoji:"üçú", persons:4, time:"35 min", kcal:null,
    ingredients:[{amount:"1",name:"ui"},{amount:"2",name:"aardappelen"},{amount:"1",name:"winterpeen"},{amount:"200 g",name:"rode linzen"},{amount:"1 el",name:"olijfolie"},{amount:"1 tl",name:"komijn"},{amount:"1 el",name:"tomatenpuree"},{amount:"¬Ω tl",name:"chiliflakes"},{amount:"2",name:"bouillonblokjes"},{amount:"naar smaak",name:"verse munt, peper en zout"},{amount:"1 partje",name:"citroen"}],
    steps:["Snipper de ui. Schil de aardappelen en winterpeen en snijd in blokjes. Spoel de linzen af.","Verhit de olie en fruit komijn, tomatenpuree en de helft van de chiliflakes 1 minuut. Voeg ui, aardappel en winterpeen toe en bak 5 minuten.","Voeg 1,5 liter water, bouillonblokjes en linzen toe. Breng aan de kook en laat 20 minuten koken.","Pureer de soep met een staafmixer. Breng op smaak met peper en zout.","Garneer met munt en chiliflakes. Serveer met een partje citroen."],
    tip:null, source:"https://www.jumbo.com/recepten/turkse-linzensoep-503979"
  },
  {
    id:6, name:"Aardappelsalade: fris en romig", emoji:"ü•ó", persons:6, time:"30 min", kcal:null,
    ingredients:[{amount:"1 kg",name:"vastkokende aardappels"},{amount:"1 teen",name:"knoflook"},{amount:"1 tl",name:"mosterd"},{amount:"8",name:"kleine augurken"},{amount:"naar smaak",name:"verse bieslook"},{amount:"6 el",name:"yoghurt"},{amount:"4 el",name:"mayonaise"},{amount:"2",name:"eieren"},{amount:"naar smaak",name:"peper en zout"}],
    steps:["Schil de aardappels en snijd in blokjes van ca. 1 cm.","Kook de aardappels 10 minuten in water met zout. Giet af en spoel met koud water.","Kook de eieren hardgekookt in 8 minuten. Spoel af met koud water.","Meng yoghurt, mosterd, mayonaise en knoflook. Breng op smaak met peper, zout en bieslook.","Snijd augurkjes en eieren fijn. Meng door de aardappels.","Schep de bieslooksaus door de salade.","Laat minimaal een uur afkoelen in de koelkast."],
    tip:null, source:"https://www.leukerecepten.nl/recepten/aardappelsalade/"
  },
  {
    id:7, name:"Rijstschotel met tonijn en sperziebonen", emoji:"üçö", persons:2, time:"25 min", kcal:null,
    ingredients:[{amount:"150 g",name:"rijst"},{amount:"1 blikje",name:"tonijn op olie (160 g)"},{amount:"1",name:"ui"},{amount:"1 teen",name:"knoflook"},{amount:"1",name:"rode peper"},{amount:"200 g",name:"sperziebonen"},{amount:"2",name:"paprika's"},{amount:"3 tl",name:"pesto"},{amount:"1 tl",name:"paprikapoeder"},{amount:"1 el",name:"basilicum"},{amount:"snufje",name:"zwarte peper"},{amount:"50 g",name:"feta"}],
    steps:["Kook de rijst volgens de verpakking.","Kook de sperziebonen ca. 8 minuten.","Snijd de ui, rode peper, paprika's en feta in stukjes.","Fruit de ui met knoflook en rode peper in olie.","Voeg de paprika toe en bak 3-4 minuten mee.","Voeg paprikapoeder, pesto en tonijn toe en meng goed.","Voeg de sperziebonen en rijst toe, meng goed.","Serveer met blokjes feta erbovenop."],
    tip:null, source:"https://www.lekkerensimpel.com/rijstschotel-met-tonijn-en-sperziebonen/"
  },
  {
    id:8, name:"Romige zuurkoolschotel", emoji:"ü•î", persons:4, time:"55 min", kcal:null,
    ingredients:[{amount:"250 g",name:"gerookte spekreepjes"},{amount:"150 ml",name:"water"},{amount:"750 g",name:"aardappelen"},{amount:"2 teentjes",name:"knoflook"},{amount:"1",name:"ui"},{amount:"1 el",name:"tomatenpuree"},{amount:"500 g",name:"zuurkool"},{amount:"naar smaak",name:"peper"},{amount:"200 ml",name:"cr√®me fra√Æche"},{amount:"100 g",name:"geraspte kaas"},{amount:"1 tl",name:"oregano"}],
    steps:["Kook de aardappelen 20 minuten gaar. Bak de spekreepjes 4 minuten knapperig.","Voeg knoflook en ui toe, bak 4 min. Schep tomatenpuree erdoor en bak 1 min. Voeg zuurkool met water toe en stoof 15 min. Verwarm oven op 200 ¬∞C.","Giet aardappelen af, vang kookvocht op. Stamp tot smeu√Øge puree.","Schep helft puree in ovenschaal, verdeel zuurkool erover, dek af met rest van de puree.","Meng cr√®me fra√Æche met kaas en oregano. Strijk over de puree.","Bak 20-25 minuten goudbruin in de oven."],
    tip:null, source:"https://www.jumbo.com/recepten/romige-zuurkoolschotel-502745"
  },
  {
    id:9, name:"Vegetarische aardappel-broccoli ovenschotel", emoji:"ü•¶", persons:4, time:"40 min", kcal:null,
    ingredients:[{amount:"4",name:"eieren"},{amount:"900 g",name:"broccoliroosjes"},{amount:"750 g",name:"aardappelpuree"},{amount:"175 g",name:"geraspte oude kaas"},{amount:"125 ml",name:"cr√®me fra√Æche"},{amount:"6 el",name:"melk"},{amount:"1",name:"ui"},{amount:"1 teen",name:"knoflook"},{amount:"1 mespunt",name:"gedroogde nootmuskaat"},{amount:"1 el",name:"olijfolie"},{amount:"naar smaak",name:"peper en zout"}],
    steps:["Verwarm de oven voor op 200 ¬∞C en vet een ovenschaal in.","Versnipper de ui en snijd de knoflook fijn.","Kook de broccoliroosjes in ca. 5 minuten n√©t niet helemaal gaar.","Fruit ui en knoflook in olijfolie. Voeg broccoli toe en roerbak even.","Klop de eieren los met cr√®me fra√Æche, melk, kaas, nootmuskaat, zout en peper. Schep door het broccolimengsel.","Schep helft van de aardappelpuree in de ovenschaal en strijk glad.","Schep het broccolimengsel erop en verdeel de resterende puree erover.","Bak 20-25 minuten tot de bovenkant goudbruin is."],
    tip:null, source:null
  },
  {
    id:10, name:"Vegetarische lasagne met linzen", emoji:"ü´ï", persons:4, time:"60 min", kcal:null,
    ingredients:[{amount:"1",name:"ui"},{amount:"1 teentje",name:"knoflook"},{amount:"100 g",name:"wortel"},{amount:"2 stengels",name:"bleekselderij"},{amount:"1",name:"paprika"},{amount:"250 g",name:"champignons"},{amount:"400 g",name:"tomatenblokjes"},{amount:"40 g",name:"tomatenpuree"},{amount:"240 g",name:"linzen (uitgelekt)"},{amount:"1-2 el",name:"Italiaanse kruiden"},{amount:"1",name:"bouillonblokje groente"},{amount:"200 g",name:"lasagnebladen"},{amount:"60 g",name:"Parmezaanse kaas"},{amount:"75 g",name:"boter (bechamel)"},{amount:"75 g",name:"tarwebloem (bechamel)"},{amount:"450 ml",name:"halfvolle melk (bechamel)"},{amount:"450 ml",name:"water (bechamel)"},{amount:"naar smaak",name:"nootmuskaat, peper en zout"}],
    steps:["Verwarm de oven voor op 180 ¬∞C.","Snipper ui, knoflook, wortel en bleekselderij. Bak in olijfolie. Voeg paprika en champignons toe en bak gaar.","Voeg tomatenpuree, tomatenblokjes, 400 ml water, bouillonblokje en kruiden toe. Laat 15 min pruttelen.","Giet linzen af, spoel en voeg toe. Breng op smaak en laat 5 min pruttelen.","Bechamel: smelt boter, roer bloem erdoor, voeg afwisselend melk en water toe tot gladde saus. Breng op smaak.","Bouw lasagne op: rode saus, lasagnebladen, bechamel, herhaal. Eindig met bechamel en Parmezaan.","Bak 20-30 minuten tot goudbruin."],
    tip:null, source:"https://foxilicious.nl/vegetarische-lasagne-bolognese"
  },
  {
    id:11, name:"Vegetarische cannelloni", emoji:"ü´ô", persons:8, time:"60 min", kcal:null,
    ingredients:[{amount:"2",name:"uien"},{amount:"6 el",name:"milde olijfolie"},{amount:"1200 g",name:"verse spinazie"},{amount:"500 g",name:"ricotta"},{amount:"2 snufjes",name:"gemalen nootmuskaat"},{amount:"naar smaak",name:"peper en zout"},{amount:"550 g",name:"vegan veldbonen gehakt"},{amount:"500 g",name:"mascarpone"},{amount:"1000 g",name:"gezeefde tomaten"},{amount:"400 g",name:"cannelloni"}],
    steps:["Verwarm de oven voor op 180 ¬∞C. Fruit de gesnipperde uien 2 min. Voeg spinazie in delen toe en laat slinken. Laat uitlekken en druk het vocht eruit.","Doe spinazie en ricotta in een hakmolen en maal fijn. Breng op smaak met nootmuskaat, peper en zout.","Bak het veldbonen gehakt 4 min. rul. Breng op smaak.","Klop mascarpone los met gezeefde tomaten. Verdeel 2 el tomatensaus over elke ovenschaal.","Vul de cannelloni met het spinaziemengsel via een spuitzak. Verdeel in de ovenschalen. Verdeel het gehakt en tomatensaus erover.","Bak ca. 40 min. in het midden van de oven gaar."],
    tip:null, source:"https://www.ah.nl/r/931316"
  }
];

function load() {
  try { const s = localStorage.getItem(KEY); if (s) return JSON.parse(s); } catch(e) {}
  save(DEFAULTS);
  return DEFAULTS;
}
function save(data) { localStorage.setItem(KEY, JSON.stringify(data)); }

// ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ
function showView(id) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('on'));
  document.getElementById(id).classList.add('on');
  window.scrollTo(0, 0);
}
function gotoList() { renderList(); showView('v-list'); }
function gotoForm() {
  ['f-name','f-emoji','f-persons','f-time','f-kcal','f-ingredients','f-steps','f-tip','f-source'].forEach(id => document.getElementById(id).value = '');
  showView('v-form');
}
function gotoPaste() {
  document.getElementById('paste-input').value = '';
  document.getElementById('parse-result').classList.add('hidden');
  document.getElementById('confirm-btn').classList.add('hidden');
  showView('v-paste');
}

// ‚îÄ‚îÄ LIST ‚îÄ‚îÄ
function renderList() {
  const recipes = load();
  const q = (document.getElementById('search-input').value || '').toLowerCase();
  const filtered = recipes.filter(r => r.name.toLowerCase().includes(q));
  document.getElementById('count-label').textContent = filtered.length + ' recept' + (filtered.length !== 1 ? 'en' : '');
  const grid = document.getElementById('recipe-grid');
  if (!filtered.length) {
    grid.innerHTML = `<div class="empty-state"><div class="emoji">${q ? 'üîç' : 'ü•Ñ'}</div><p>${q ? 'Geen recepten gevonden voor "' + q + '".' : 'Nog geen recepten.<br>Druk op <strong>+</strong> om er een toe te voegen!'}</p></div>`;
    return;
  }
  grid.innerHTML = filtered.map(r => `
    <div class="recipe-card" onclick="gotoDetail(${r.id})">
      <div class="card-img">${r.emoji || 'üçΩÔ∏è'}</div>
      <div class="card-body">
        <div class="card-name">${r.name}</div>
        <div class="card-tags">
          ${r.time ? `<span class="tag">‚è± ${r.time}</span>` : ''}
          ${r.kcal ? `<span class="tag">${r.kcal} kcal</span>` : ''}
          ${r.persons ? `<span class="tag green">üë• ${r.persons} p.</span>` : ''}
        </div>
        <div class="card-meta-row">
          <span class="card-meta-item">ü•ï ${r.ingredients.length} ingredi√´nten</span>
          <span class="card-meta-item">üìã ${r.steps.length} stappen</span>
        </div>
      </div>
      <div class="card-arrow">‚Ä∫</div>
    </div>
  `).join('');
}

// ‚îÄ‚îÄ DETAIL ‚îÄ‚îÄ
let curPersons = {};

function gotoDetail(id) {
  const r = load().find(x => x.id === id);
  if (!r) return;
  document.getElementById('detail-header').textContent = r.name;
  curPersons[id] = curPersons[id] || r.persons || 4;
  renderDetail(r);
  showView('v-detail');
}

function renderDetail(r) {
  const base = r.persons || 4;
  const cur = curPersons[r.id];
  const ratio = cur / base;
  function scale(amt) {
    if (!amt) return '';
    const m = amt.match(/^([\d\/\.,]+)(.*)/);
    if (!m) return amt;
    let n = parseFloat(m[1].replace(',', '.'));
    if (isNaN(n)) return amt;
    n = Math.round(n * ratio * 10) / 10;
    return n + m[2];
  }
  document.getElementById('detail-content').innerHTML = `
    <div class="detail-hero">${r.emoji || 'üçΩÔ∏è'}</div>
    <div class="detail-body">
      <h1 class="detail-title">${r.name}</h1>
      ${r.source ? `<div class="source-line">Bron: <a href="${r.source}" target="_blank">${r.source.replace(/https?:\/\/(www\.)?/, '').split('/')[0]}</a></div>` : ''}
      <div class="stats-row">
        ${r.persons ? `<div class="stat"><div class="stat-icon">üë•</div><div class="stat-val">${r.persons}</div><div class="stat-lbl">personen</div></div>` : ''}
        ${r.time ? `<div class="stat"><div class="stat-icon">‚è±</div><div class="stat-val">${r.time}</div><div class="stat-lbl">bereiden</div></div>` : ''}
        ${r.kcal ? `<div class="stat"><div class="stat-icon">üî•</div><div class="stat-val">${Math.round(r.kcal * ratio)}</div><div class="stat-lbl">kcal</div></div>` : ''}
      </div>
      <div class="sec-title">üõí Ingredi√´nten</div>
      <div class="persons-row">
        <span class="persons-lbl">Aantal personen:</span>
        <div class="persons-ctrl">
          <button class="p-btn" onclick="changePersoons(${r.id}, -1)">‚àí</button>
          <div class="p-val">${cur}</div>
          <button class="p-btn" onclick="changePersoons(${r.id}, 1)">+</button>
        </div>
      </div>
      <ul class="ingr-list">
        ${r.ingredients.map(i => `<li class="ingr-item"><span class="ingr-amt">${scale(i.amount)}</span><span class="ingr-name">${i.name}</span></li>`).join('')}
      </ul>
      <div class="sec-title">üë®‚Äçüç≥ Aan de slag</div>
      <ol class="step-list">
        ${r.steps.map((s, i) => `<li class="step-item"><span class="step-num">${i + 1}</span><span>${s}</span></li>`).join('')}
      </ol>
      ${r.tip ? `<div class="tip-box">üí° <strong>Tip:</strong> ${r.tip}</div>` : ''}
      <button class="del-btn" onclick="deleteRecipe(${r.id})">üóë Recept verwijderen</button>
    </div>
  `;
}

function changePersoons(id, delta) {
  const r = load().find(x => x.id === id);
  if (!r) return;
  curPersons[id] = Math.max(1, (curPersons[id] || r.persons || 4) + delta);
  renderDetail(r);
}

// ‚îÄ‚îÄ FORM SAVE ‚îÄ‚îÄ
function parseIngredients(text) {
  return text.split('\n').map(l => l.replace(/^[\*\-‚Ä¢]\s*/, '').trim()).filter(Boolean).map(l => {
    const m = l.match(/^([\d\/\.,¬Ω¬º¬æ]+\s*(?:g|kg|ml|l|el|tl|blik|liter|stuks?|zakje|pak|bos|tenen?|snufje|mespunt)?\.?)\s+(.+)/i);
    return m ? { amount: m[1].trim(), name: m[2].trim() } : { amount: '', name: l };
  });
}
function parseSteps(text) {
  return text.split('\n').map(l => l.replace(/^\d+[\.\)]\s*/, '').trim()).filter(Boolean);
}

function saveRecipe() {
  const name = document.getElementById('f-name').value.trim();
  if (!name) { alert('Vul een naam in.'); return; }
  const ingrText = document.getElementById('f-ingredients').value;
  const stepsText = document.getElementById('f-steps').value;
  if (!ingrText.trim()) { alert('Voeg ingredi√´nten toe.'); return; }
  if (!stepsText.trim()) { alert('Voeg stappen toe.'); return; }
  const recipes = load();
  recipes.push({
    id: Date.now(), name,
    emoji: document.getElementById('f-emoji').value.trim() || 'üçΩÔ∏è',
    persons: parseInt(document.getElementById('f-persons').value) || 4,
    time: document.getElementById('f-time').value.trim() || null,
    kcal: parseInt(document.getElementById('f-kcal').value) || null,
    ingredients: parseIngredients(ingrText),
    steps: parseSteps(stepsText),
    tip: document.getElementById('f-tip').value.trim() || null,
    source: document.getElementById('f-source').value.trim() || null
  });
  save(recipes);
  gotoList();
}

function deleteRecipe(id) {
  if (!confirm('Recept verwijderen?')) return;
  save(load().filter(r => r.id !== id));
  gotoList();
}

// ‚îÄ‚îÄ PASTE / PARSE ‚îÄ‚îÄ
let _parsed = null;

function parseRecipe() {
  const text = document.getElementById('paste-input').value.trim();
  if (!text) { alert('Plak eerst een recept.'); return; }

  // Naam: eerste # heading of eerste niet-lege regel
  let name = '';
  const hm = text.match(/^#+\s*(.+)/m);
  if (hm) name = hm[1].replace(/#\w+/g, '').trim();
  if (!name) name = text.split('\n').find(l => l.trim() && !l.startsWith('#') && !l.match(/^voor\s+\d/i))?.trim() || 'Nieuw recept';
  name = name.replace(/[\*\_]/g, '').replace(/recept/i, '').trim() || name.trim();

  // Personen
  const pm = text.match(/voor\s+(\d+)\s*personen/i);
  const persons = pm ? parseInt(pm[1]) : 4;

  // URL
  const um = text.match(/https?:\/\/[^\s\)\]]+/);
  const source = um ? um[0].replace(/[>\]]+$/, '') : null;

  // Splits tekst in secties op basis van koppen
  const lines = text.split('\n');
  let inIngr = false, inSteps = false;
  const ingrLines = [], stepLines = [];

  for (const line of lines) {
    const l = line.trim();
    if (!l) continue;
    if (/^#+\s*(ingredi[e√´]nten)/i.test(l) || /^(ingredi[e√´]nten)\s*$/i.test(l)) { inIngr = true; inSteps = false; continue; }
    if (/^#+\s*(bereiding|aan de slag|werkwijze)/i.test(l) || /^(bereiding(?:swijze)?|aan de slag)\s*$/i.test(l)) { inSteps = true; inIngr = false; continue; }
    if (/^#+/.test(l) && (inIngr || inSteps)) { inIngr = false; inSteps = false; }
    if (inIngr) ingrLines.push(l);
    if (inSteps) stepLines.push(l);
  }

  // Fallback: bullet = ingredi√´nt, genummerd = stap
  if (!ingrLines.length && !stepLines.length) {
    for (const line of lines) {
      const l = line.trim();
      if (!l) continue;
      if (/^\d+[\.\)]/.test(l)) stepLines.push(l);
      else if (/^[\*\-‚Ä¢]/.test(l)) ingrLines.push(l);
    }
  }

  // Verwerk ingredi√´nten
  const ingredients = ingrLines
    .map(l => l.replace(/^[\*\-‚Ä¢\t]\s*/, '').trim())
    .filter(l => l && l.length > 1 && !/^(ingredi[e√´]nten|voor\s+\d|bron|#)/i.test(l))
    .map(l => {
      const m = l.match(/^([\d\/\.,¬Ω¬º¬æ]+\s*(?:g|kg|ml|l|el|tl|blik|liter|stuks?|zakje|pak|bos|tenen?|snufje|mespunt|cm)?\.?)\s+(.+)/i);
      return m ? { amount: m[1].trim(), name: m[2].trim() } : { amount: '', name: l };
    });

  // Verwerk stappen
  const steps = stepLines
    .map(l => l.replace(/^\d+[\.\)]\s*/, '').replace(/^[\*\-‚Ä¢]\s*/, '').trim())
    .filter(l => l && l.length > 5 && !/^(bereiding|bron|#recept)/i.test(l));

  if (!ingredients.length) { alert('Kon geen ingredi√´nten herkennen. Zorg dat er een "Ingredi√´nten" kopje in de tekst staat, of gebruik - bullets.'); return; }
  if (!steps.length) { alert('Kon geen bereidingsstappen herkennen. Zorg dat er een "Bereidingswijze" kopje in de tekst staat, of gebruik 1. 2. 3. nummering.'); return; }

  _parsed = { id: Date.now(), name, emoji: 'üçΩÔ∏è', persons, time: null, kcal: null, ingredients, steps, tip: null, source };

  const resultEl = document.getElementById('parse-result');
  resultEl.classList.remove('hidden');
  resultEl.innerHTML = `
    <strong>Naam:</strong> ${name}<br>
    <strong>Personen:</strong> ${persons}<br>
    <strong>Ingredi√´nten (${ingredients.length}):</strong> ${ingredients.slice(0, 4).map(i => (i.amount + ' ' + i.name).trim()).join(', ')}${ingredients.length > 4 ? ' ‚Ä¶' : ''}<br>
    <strong>Stappen:</strong> ${steps.length} stappen gevonden<br>
    ${source ? `<strong>Bron:</strong> ${source.replace(/https?:\/\/(www\.)?/, '').split('/')[0]}` : ''}
  `;
  document.getElementById('confirm-btn').classList.remove('hidden');
}

function confirmPaste() {
  if (!_parsed) return;
  const recipes = load();
  recipes.push(_parsed);
  save(recipes);
  _parsed = null;
  gotoList();
}

// ‚îÄ‚îÄ BACKUP ‚îÄ‚îÄ
function exportRecipes() {
  const a = Object.assign(document.createElement('a'), {
    href: URL.createObjectURL(new Blob([JSON.stringify(load(), null, 2)], { type: 'application/json' })),
    download: 'recepten-backup.json'
  });
  a.click();
}

function importRecipes(e) {
  const file = e.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    try {
      const data = JSON.parse(ev.target.result);
      if (!Array.isArray(data)) throw 0;
      if (confirm(data.length + ' recepten gevonden. Huidige overschrijven?')) { save(data); renderList(); alert('Ge√Ømporteerd!'); }
    } catch { alert('Ongeldig bestand.'); }
  };
  reader.readAsText(file);
  e.target.value = '';
}

// ‚îÄ‚îÄ START ‚îÄ‚îÄ
gotoList();
</script>
</body>
</html>
